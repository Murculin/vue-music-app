# 组件位置

在app.vue中引入保证在整个app中运行

通过vuex中的fullScreen属性控制显示隐藏

# audio API

#### 属性

src  播放地址

e.target 中取：

duration  总时间

currentTime  当前播放的时间  可读可写

#### 方法

timeupdate  播放时间推移后触发

ended  播放结束时触发

canplay 准备就绪可以播放时触发

audio.play() 播放

# Vuex中相关的数据

```js
export const state = {
    playing: false, // 是否播放
    fullScreen: false, // 是否全屏
    playlist: [], // 播放列表(排序后)
    sequenceList: [], // 原始播放列表
    mode: 0, // 播放模式 0顺序循环 1随机 2单曲循环
    currentIndex: -1, // 当前播放列表中的第几首
    playHistory: loadPlay()   //  播放历史
}
// getters
export const getCurrentSong = (state) => {
  return state.playlist[state.currentIndex] || {}
}
```

# 控制播放

watch中监听playing的改变

```js
    playing (newVal) {
      this.$nextTick(() => {
        newVal ? this.$refs.audio.play() : this.$refs.audio.pause()
      })
    }
```

这样改变playing就改变了实际的播放状态

# 控制进度

计算属性中定义percent = currentTime / duration

监听percent 

若进度条按钮没被按下,随着percent推动进度条

# 进度条

总长度width = 进度条长度 - 按钮大小

## 点击开始

设置当前进度条和按钮的位置

记录对应的时间用来更新ui

## 结束过程

设置currentTime  如果当前暂停则设置播放

## 点击进度条跳转

```js
const offsetX = e.pageX - this.$refs.progressBar.offsetLeft
```

范围控制在0-width

设置当前进度条和按钮的位置



# cd效果

animation-play-state 控制播放和暂停动画

*animation* rotate 20s linear infinite

@keyframes rotate

  0%

   *transform*: rotate(0)

  100%

   *transform*: rotate(360deg)

## 切换

共有两个cd

切换显示

为切换绑定过渡

# 歌词

### 格式处理

```js
const reg = /\[(\d+:\d+.\d+)\]/
```



## 正在播放的歌词

监听currentTime

不停检查currentTime和歌词中记录的时间得到正在播放歌词的onIndex  绿色显示

监听onIndex的变化，变了就触发滚动

## 被选到的歌词

让scroll的滚动远点在屏幕中心

监听滚动，nextIndex = 滚动距离/每个装有歌词的div的高  白色显示

